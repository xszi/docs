(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{378:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"可视化的javascript-一-事件循环"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可视化的javascript-一-事件循环"}},[t._v("#")]),t._v(" 可视化的JavaScript —— （一）事件循环")]),t._v(" "),a("p",[t._v("文章来源："),a("a",{attrs:{href:"https://dev.to/lydiahallie/series/3341",target:"_blank",rel:"noopener noreferrer"}},[t._v("JavaScript Visualized Series' Articles"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("【一】"),a("a",{attrs:{href:"https://dev.to/lydiahallie/javascript-visualized-event-loop-3dif",target:"_blank",rel:"noopener noreferrer"}},[t._v("JavaScript Visualized: Event Loop"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("事件循环是每个"),a("strong",[t._v("JavaScript")]),t._v("开发人员都必须以某种方式掌握的事情之一，起初理解起来可能并不容易。我是一个视觉学习者，所以我想通过低分辨率"),a("strong",[t._v("gif动画")]),t._v("这种视觉方式来帮助您加深理解，是的，在2019年，"),a("strong",[t._v("gif动画")]),t._v("仍然有点像素化和模糊。")]),t._v(" "),a("p",[t._v("首先，事件循环是什么，为什么我们要关心呢？")]),t._v(" "),a("p",[t._v("JavaScript是单线程的：一次只能运行一个任务。")]),t._v(" "),a("p",[t._v("通常，这没什么大不了的，但是现在想象您正在运行一个耗时30秒的任务。是的。在此任务中，我们等待30秒才能进行其他任何操作（默认情况下，JavaScript在浏览器的主线程上运行，因此整个用户界面都停滞了））。在2019年，没有人想要一个速度慢，反应迟钝的网站。")]),t._v(" "),a("p",[t._v("幸运的是，浏览器为我们提供了JavaScript引擎本身不提供的一些功能：Web API。这包括DOM API，setTimeout/HTTP请求等。这可以帮助我们创建一些异步的，非阻塞的行为。")]),t._v(" "),a("p",[t._v("当我们调用一个函数时，它将被添加到调用栈中。调用堆栈是JS引擎的一部分，这不是特定于浏览器的。它是一个堆栈，这意味着它是先进后出的（想像一堆煎饼）。当一个函数返回一个值时，它会从堆栈中弹出")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/116499617-311ba200-a8df-11eb-97e3-99137c331d56.gif",alt:"gid1 6"}})]),t._v(" "),a("p",[t._v("该respond函数返回一个setTimeout函数。setTimeout函数由Web API提供：它让我们延迟任务执行，而不会阻塞主线程。我们传递给该setTimeout函数的回调函数 —— 箭头函数"),a("code",[t._v("() => { return 'Hey'}")]),t._v("，会添加到Web API。同时，该setTimeout函数和response函数从堆栈中弹出，并且都返回了它们的值！")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/116508326-af823f00-a8f3-11eb-9459-6e3ae371209e.gif",alt:"gif2 1"}})]),t._v(" "),a("p",[t._v("在Web API中，计时器的运行时间与我们传递给它的第二个参数1000ms一样长。回调不会立即添加到调用堆栈中，而是会传递给队列。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/116508537-2fa8a480-a8f4-11eb-8cee-274379620813.gif",alt:"gif3 1"}})]),t._v(" "),a("p",[t._v("这可能是一个令人困惑的部分：这并不意味着在1000毫秒后将回调函数添加到调用堆栈中（从而返回一个值）！它"),a("strong",[t._v("只是在1000毫秒后添加到队列中")]),t._v("。但这是一个队列，该函数执行必须等待轮到它！")]),t._v(" "),a("p",[t._v("现在就是大家一直期待的部分了 —— 让事件循环执行其唯一的任务：将队列与调用堆栈连接起来。如果调用堆栈为空，且所有先前调用的函数都返回了它们的值并已从堆栈中弹出，就将队列中的第一项添加到调用堆栈中。在这种情况下，当回调函数为队列中的第一项，没有其他函数被调用时，调用堆栈是空的。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/116509113-50bdc500-a8f5-11eb-84c8-3a6f13361eac.gif",alt:"gif4"}})]),t._v(" "),a("p",[t._v("回调被添加到调用堆栈中被调用，并返回一个值，并从堆栈中弹出。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/116509139-616e3b00-a8f5-11eb-9d1d-bb2b915ca61b.gif",alt:"gif5"}})]),t._v(" "),a("p",[t._v("阅读一篇文章很有趣，但是通过反复地实际使用它，您只会对此完全感到满意运行以下命令，尝试获取打印到控制台的内容：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("foo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"First"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("bar")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Second"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("baz")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Third"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("baz")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("搞明白了吗？让我们快速看一下在浏览器中运行此代码时发生的情况：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/116509473-f07b5300-a8f5-11eb-854f-dc766c590238.gif",alt:"gif14 1"}})]),t._v(" "),a("ul",[a("li",[t._v("我们调用bar。bar返回一个setTimeout函数。")]),t._v(" "),a("li",[t._v("我们传递给setTimeout的回调被添加到Web API，该setTimeout函数和bar从调用堆栈中弹出。")]),t._v(" "),a("li",[t._v("计时器运行，与此同时，它foo被调用并打印日志First。foo返回（未定义），baz被调用，并将回调添加到队列中。")]),t._v(" "),a("li",[t._v("baz打印Third。事件循环看到baz返回后调用栈为空，然后将回调添加到调用栈。打印日志Second。")])]),t._v(" "),a("p",[t._v("【完】")])])}),[],!1,null,null,null);s.default=e.exports}}]);